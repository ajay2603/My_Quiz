<%- include("mainhead") -%>
<script src="/socket.io/socket.io.js"></script>
<script>
var room = '<%= room %>';
var member = "<%= member %>"
const socket = io();
</script>
<script>
    var qid = "";
    var opid = "";
    var quesid = "";
    var optid = '';
    var clicked = true;
    var submit = false;
    let startTime;
    var timeDiff;
</script>
<div class="exmi-cond">

    <div class = "question">

        <div class = "ques-cont">
            <h3 style="margin-bottom: 20px;
            padding-left: 10px;" id = "q">Hello</h3>
            <div class="opt" id = 'a' onclick = "setAnswer(this)"><h4>Balu</h4></div>
            <div class="opt" id = 'b' onclick = "setAnswer(this)"><h4>Balu</h4></div>
            <div class="opt" id = 'c' onclick = "setAnswer(this)"><h4>Balu</h4></div>
            <div class="opt" id = 'd' onclick = "setAnswer(this)"><h4>Balu</h4></div>
        </div>

    </div>

    <div class = "scores">
        <h1 id = "count-down-stat">Quiz starts in </h1>
        <h1 id = "count-down">10</h1>
        <hr style="border-style: solid; width: 95%;">
        <div class="score-graph">

        </div>
    </div>

    <div class="evalDisp">
        <h1>Evaluating Scores</h1>
    </div>

</div>
<script>

    function setAnswer(opt){
        
        if(clicked){
            alert("already selected");
            return;
        }
        const stopTime = new Date();
        const timeDiffInSeconds = Math.abs((stopTime.getTime() - startTime.getTime()) / 1000);
        const timeDiffInMilliseconds = Math.abs(stopTime.getTime() - startTime.getTime());
        timeDiff = timeDiffInSeconds.toFixed(5);

        var qu = document.getElementById('q');
        console.log(qu.attributes.qid);
        var op = document.getElementById(opt.id);
        opid = op.attributes.oid;
        console.log(opid)
        op.style.backgroundColor = '#687EFF';
        quesid = qu.attributes.qid.value;
        optid = opid.value;
        console.log({qid : qu.attributes.qid.value, opt : opid.value,time : timeDiff});
        clicked = true;
        //socket.emit("valques",room,member,{qid : qu.attributes.qid.value, opt : opid.value,time : timeDiff})
    }
</script>
<script>

    socket.on('reqAns',()=>{
        if(clicked)
        socket.emit("valques",room,member,{qid : quesid, opt : optid,time : timeDiff})
        else{
            console.log({qid : qid, opt : opid.value,time : timeDiff});
            socket.emit("valques",room,member,{qid : quesid, opt : optid,time : timeDiff})
        }
        optid = "";
    })

    socket.on('qsctcd',(sec) => {
        document.getElementById('count-down').innerHTML = sec;
    });

socket.on('joinresp',(msg,stat) => {
    alert(msg);
});

socket.on('recMsg',(ques) => {
    alert(msg);
});

socket.on('dispScore',() => {
    document.getElementsByClassName('scores')[0].style.display = 'flex';
})

socket.on('question',(ques) => {
    clicked = false;
    document.querySelectorAll('.opt').forEach(element => {
    element.style.backgroundColor = '#e8e8e8';
});

document.getElementsByClassName('scores')[0].style.display = "none";
    var q = document.getElementById('q')
    q.setAttribute('qid',ques.qid);
    q.innerHTML = ques.questionName;
    var a = document.getElementById('a')
    a.setAttribute('oid',ques.optiona.oid);
    a.innerHTML = ques.optiona.opt;
    var b = document.getElementById('b')
    b.setAttribute('oid',ques.optionb.oid);
    b.innerHTML = ques.optionb.opt;
    var c = document.getElementById('c')
    c.setAttribute('oid',ques.optionc.oid);
    c.innerHTML = ques.optionc.opt;
    var d = document.getElementById('d')
    d.setAttribute('oid',ques.optiond.oid);
    d.innerHTML = ques.optiond.opt;
    startTime = new Date();
});

socket.emit('joinroom',{room : room, member: member});
</script>


<%- include("mainfooter")-%>